 <!DOCTYPE html>

<html lang="pl">

<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Kalkulator Zysk√≥w</title>

    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>

    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script src="https://cdn.tailwindcss.com"></script>

    <style>

        body { background: linear-gradient(135deg, #0a1f1a 0%, #0d2820 50%, #081712 100%); }

    </style>

</head>

<body>

    <div id="root"></div>

    <script type="text/babel">

        const { useState, useEffect } = React;


        function App() {

            const [activeTab, setActiveTab] = useState('base');

            const [baseCrops, setBaseCrops] = useState([]);

            const [recipes, setRecipes] = useState([]);

            const [nextBaseCropId, setNextBaseCropId] = useState(1);

            const [nextRecipeId, setNextRecipeId] = useState(1);

            const [loading, setLoading] = useState(true);

            const [saving, setSaving] = useState(false);

            const [message, setMessage] = useState('');

            const [sortBy, setSortBy] = useState('name');

            const [sortOrder, setSortOrder] = useState('asc');


            useEffect(() => { loadData(); }, []);


            const loadData = async () => {

                try {

                    setLoading(true);

                    const result = await window.storage.get('kalkulator-upraw-data', true);

                    if (result?.value) {

                        const data = JSON.parse(result.value);

                        setBaseCrops(data.baseCrops || []);

                        setRecipes(data.recipes || []);

                        setNextBaseCropId(data.nextBaseCropId || 1);

                        setNextRecipeId(data.nextRecipeId || 1);

                    } else {

                        setBaseCrops([

                            { id: 1, name: 'Pszenica', buyPrice: 10, sellPrice: 12, time: 2 },

                            { id: 2, name: 'Mleko', buyPrice: 15, sellPrice: 18, time: 1 }

                        ]);

                        setRecipes([{ id: 1, name: 'Chleb', ingredients: [{crop: 'Pszenica', amount: 3}], sellPrice: 50 }]);

                        setNextBaseCropId(3);

                        setNextRecipeId(2);

                    }

                } catch (e) {

                    setBaseCrops([

                        { id: 1, name: 'Pszenica', buyPrice: 10, sellPrice: 12, time: 2 },

                        { id: 2, name: 'Mleko', buyPrice: 15, sellPrice: 18, time: 1 }

                    ]);

                    setRecipes([{ id: 1, name: 'Chleb', ingredients: [{crop: 'Pszenica', amount: 3}], sellPrice: 50 }]);

                    setNextBaseCropId(3);

                    setNextRecipeId(2);

                } finally {

                    setLoading(false);

                }

            };


            const saveData = async (bc, r, bcId, rId) => {

                try {

                    setSaving(true);

                    await window.storage.set('kalkulator-upraw-data', JSON.stringify({

                        baseCrops: bc, recipes: r, nextBaseCropId: bcId, nextRecipeId: rId

                    }), true);

                    setMessage('‚úì Zapisano');

                    setTimeout(() => setMessage(''), 2000);

                } catch (e) {

                    setMessage('‚úó B≈ÇƒÖd');

                    setTimeout(() => setMessage(''), 2000);

                } finally {

                    setSaving(false);

                }

            };


            const addBaseCrop = () => {

                const nb = [...baseCrops, { id: nextBaseCropId, name: '', buyPrice: 0, sellPrice: 0, time: 0 }];

                setBaseCrops(nb);

                setNextBaseCropId(nextBaseCropId + 1);

                saveData(nb, recipes, nextBaseCropId + 1, nextRecipeId);

            };


            const updateBaseCrop = (id, field, value) => {

                const nb = baseCrops.map(c => c.id === id ? { ...c, [field]: value } : c);

                setBaseCrops(nb);

                saveData(nb, recipes, nextBaseCropId, nextRecipeId);

            };


            const deleteBaseCrop = (id) => {

                const nb = baseCrops.filter(c => c.id !== id);

                setBaseCrops(nb);

                saveData(nb, recipes, nextBaseCropId, nextRecipeId);

            };


            const sortCrops = (crops) => {

                return [...crops].sort((a, b) => {

                    let av, bv;

                    if (sortBy === 'name') {

                        av = a.name.toLowerCase();

                        bv = b.name.toLowerCase();

                        return sortOrder === 'asc' ? av.localeCompare(bv) : bv.localeCompare(av);

                    } else {

                        av = a[sortBy];

                        bv = b[sortBy];

                        return sortOrder === 'asc' ? av - bv : bv - av;

                    }

                });

            };


            const handleSort = (col) => {

                if (sortBy === col) {

                    setSortOrder(sortOrder === 'asc' ? 'desc' : 'asc');

                } else {

                    setSortBy(col);

                    setSortOrder('asc');

                }

            };


            const addRecipe = () => {

                const nr = [...recipes, { id: nextRecipeId, name: '', ingredients: [], sellPrice: 0 }];

                setRecipes(nr);

                setNextRecipeId(nextRecipeId + 1);

                saveData(baseCrops, nr, nextBaseCropId, nextRecipeId + 1);

            };


            const updateRecipe = (id, field, value) => {

                const nr = recipes.map(r => r.id === id ? { ...r, [field]: value } : r);

                setRecipes(nr);

                saveData(baseCrops, nr, nextBaseCropId, nextRecipeId);

            };


            const deleteRecipe = (id) => {

                const nr = recipes.filter(r => r.id !== id);

                setRecipes(nr);

                saveData(baseCrops, nr, nextBaseCropId, nextRecipeId);

            };


            const addIngredient = (rId) => {

                const nr = recipes.map(r => r.id === rId ? { ...r, ingredients: [...r.ingredients, { crop: '', amount: 1 }] } : r);

                setRecipes(nr);

                saveData(baseCrops, nr, nextBaseCropId, nextRecipeId);

            };


            const updateIngredient = (rId, idx, field, value) => {

                const nr = recipes.map(r => {

                    if (r.id === rId) {

                        const ni = [...r.ingredients];

                        ni[idx] = { ...ni[idx], [field]: value };

                        return { ...r, ingredients: ni };

                    }

                    return r;

                });

                setRecipes(nr);

                saveData(baseCrops, nr, nextBaseCropId, nextRecipeId);

            };


            const deleteIngredient = (rId, idx) => {

                const nr = recipes.map(r => r.id === rId ? { ...r, ingredients: r.ingredients.filter((_, i) => i !== idx) } : r);

                setRecipes(nr);

                saveData(baseCrops, nr, nextBaseCropId, nextRecipeId);

            };


            const calcCost = (recipe) => {

                return recipe.ingredients.reduce((t, ing) => {

                    const c = baseCrops.find(x => x.name === ing.crop);

                    return t + (c ? c.buyPrice * ing.amount : 0);

                }, 0);

            };


            const calcProfit = (recipe) => recipe.sellPrice - calcCost(recipe);


            const resetData = async () => {

                if (confirm('Wyczy≈õciƒá wszystkie dane?')) {

                    try {

                        await window.storage.delete('shared-crops-v3', true);

                        setBaseCrops([]);

                        setRecipes([]);

                        setNextBaseCropId(1);

                        setNextRecipeId(1);

                        setMessage('‚úì Wyczyszczono');

                        setTimeout(() => setMessage(''), 2000);

                    } catch (e) {}

                }

            };


            if (loading) return <div className="min-h-screen flex items-center justify-center"><div className="text-emerald-400 text-xl">≈Åadowanie...</div></div>;


            const sorted = sortCrops(baseCrops);


            return (

                <div className="min-h-screen p-4 md:p-8">

                    <div className="max-w-7xl mx-auto">

                        <div className="bg-gradient-to-br from-emerald-900/40 to-green-950/40 backdrop-blur-sm border border-emerald-700/30 rounded-2xl shadow-2xl p-6 mb-6">

                            <div className="flex justify-between mb-6">

                                <div>

                                    <h1 className="text-4xl font-bold text-emerald-400 mb-2">Kalkulator Zysk√≥w z Upraw</h1>

                                    <p className="text-emerald-300/70 text-sm">Wsp√≥≈Çdzielone dane</p>

                                </div>

                                {(saving || message) && <span className="text-xs text-emerald-400 bg-emerald-900/30 px-2 py-1 rounded h-fit">{saving ? 'üíæ Zapisywanie...' : message}</span>}

                            </div>

                            <div className="grid grid-cols-2 gap-4">

                                <button onClick={() => setActiveTab('base')} className={`py-4 px-6 rounded-xl font-bold text-lg transition-all ${activeTab === 'base' ? 'bg-gradient-to-r from-emerald-600 to-emerald-500 text-white shadow-lg scale-105' : 'bg-slate-800/50 text-emerald-400 hover:bg-slate-700/50 border border-emerald-700/30'}`}>

                                    üì¶ Baza Cen Upraw

                                </button>

                                <button onClick={() => setActiveTab('recipes')} className={`py-4 px-6 rounded-xl font-bold text-lg transition-all ${activeTab === 'recipes' ? 'bg-gradient-to-r from-blue-600 to-blue-500 text-white shadow-lg scale-105' : 'bg-slate-800/50 text-blue-400 hover:bg-slate-700/50 border border-blue-700/30'}`}>

                                    üß™ Receptury Produkt√≥w

                                </button>

                            </div>

                        </div>


                        {activeTab === 'base' && (

                            <div className="bg-gradient-to-br from-slate-900/60 to-slate-950/60 backdrop-blur-sm border border-emerald-800/30 rounded-2xl shadow-2xl p-6">

                                <h2 className="text-2xl font-bold text-emerald-400 mb-4">üì¶ Baza Cen Upraw</h2>

                                <div className="overflow-x-auto">

                                    <table className="w-full">

                                        <thead>

                                            <tr className="border-b-2 border-emerald-700/40">

                                                <th onClick={() => handleSort('name')} className="text-left py-3 px-3 text-emerald-400 font-semibold cursor-pointer hover:bg-emerald-900/20">Nazwa {sortBy === 'name' && (sortOrder === 'asc' ? '‚ñ≤' : '‚ñº')}</th>

                                                <th onClick={() => handleSort('buyPrice')} className="text-left py-3 px-3 text-emerald-400 font-semibold cursor-pointer hover:bg-emerald-900/20">Cena Zakupu {sortBy === 'buyPrice' && (sortOrder === 'asc' ? '‚ñ≤' : '‚ñº')}</th>

                                                <th onClick={() => handleSort('sellPrice')} className="text-left py-3 px-3 text-emerald-400 font-semibold cursor-pointer hover:bg-emerald-900/20">Cena Sprzeda≈ºy {sortBy === 'sellPrice' && (sortOrder === 'asc' ? '‚ñ≤' : '‚ñº')}</th>

                                                <th onClick={() => handleSort('time')} className="text-left py-3 px-3 text-emerald-400 font-semibold cursor-pointer hover:bg-emerald-900/20">Czas (h) {sortBy === 'time' && (sortOrder === 'asc' ? '‚ñ≤' : '‚ñº')}</th>

                                                <th className="text-left py-3 px-3 text-emerald-400 font-semibold">Zysk</th>

                                                <th className="py-3 px-2"></th>

                                            </tr>

                                        </thead>

                                        <tbody>

                                            {sorted.length === 0 ? (

                                                <tr><td colSpan="6" className="text-center py-8 text-emerald-400/50">Brak upraw</td></tr>

                                            ) : (

                                                sorted.map((c, i) => (

                                                    <tr key={c.id} className={`border-b border-emerald-900/20 hover:bg-emerald-900/20 ${i % 2 === 0 ? 'bg-slate-900/30' : 'bg-slate-950/30'}`}>

                                                        <td className="py-2 px-3"><input type="text" value={c.name} onChange={(e) => updateBaseCrop(c.id, 'name', e.target.value)} placeholder="Nazwa" className="w-full px-2 py-1 bg-slate-900/80 border border-emerald-800/40 rounded text-emerald-100 text-sm"/></td>

                                                        <td className="py-2 px-3"><input type="number" value={c.buyPrice} onChange={(e) => updateBaseCrop(c.id, 'buyPrice', parseFloat(e.target.value) || 0)} className="w-full px-2 py-1 bg-slate-900/80 border border-emerald-800/40 rounded text-emerald-100 text-sm"/></td>

                                                        <td className="py-2 px-3"><input type="number" value={c.sellPrice} onChange={(e) => updateBaseCrop(c.id, 'sellPrice', parseFloat(e.target.value) || 0)} className="w-full px-2 py-1 bg-slate-900/80 border border-emerald-800/40 rounded text-emerald-100 text-sm"/></td>

                                                        <td className="py-2 px-3"><input type="number" value={c.time} onChange={(e) => updateBaseCrop(c.id, 'time', parseFloat(e.target.value) || 0)} className="w-full px-2 py-1 bg-slate-900/80 border border-emerald-800/40 rounded text-emerald-100 text-sm"/></td>

                                                        <td className="py-2 px-3"><span className="font-bold text-emerald-400 text-sm">{(c.sellPrice - c.buyPrice).toFixed(2)}</span></td>

                                                        <td className="py-2 px-2"><button onClick={() => deleteBaseCrop(c.id)} className="text-red-400 hover:bg-red-900/30 p-1 rounded">‚úï</button></td>

                                                    </tr>

                                                ))

                                            )}

                                        </tbody>

                                    </table>

                                </div>

                                <div className="flex gap-3 mt-4">

                                    <button onClick={addBaseCrop} className="px-4 py-2 bg-emerald-700 hover:bg-emerald-600 text-white rounded font-semibold">+ Dodaj Surowiec</button>

                                    <button onClick={loadData} className="px-4 py-2 bg-purple-700 hover:bg-purple-600 text-white rounded font-semibold">üîÑ Od≈õwie≈º</button>

                                </div>

                            </div>

                        )}


                        {activeTab === 'recipes' && (

                            <div className="bg-gradient-to-br from-slate-900/60 to-slate-950/60 backdrop-blur-sm border border-blue-800/30 rounded-2xl shadow-2xl p-6">

                                <h2 className="text-2xl font-bold text-blue-400 mb-4">üß™ Receptury Produkt√≥w</h2>

                                {recipes.length === 0 ? (

                                    <div className="text-center py-8 text-blue-400/50">Brak receptur</div>

                                ) : (

                                    <div className="space-y-4">

                                        {recipes.map(r => {

                                            const cost = calcCost(r);

                                            const profit = calcProfit(r);

                                            return (

                                                <div key={r.id} className="border border-blue-700/40 rounded-xl p-4 bg-slate-900/30">

                                                    <div className="grid grid-cols-2 gap-3 mb-3">

                                                        <div>

                                                            <label className="text-blue-400 text-xs mb-1 block">Produkt</label>

                                                            <input type="text" value={r.name} onChange={(e) => updateRecipe(r.id, 'name', e.target.value)} placeholder="Nazwa" className="w-full px-2 py-1 bg-slate-900/80 border border-blue-800/40 rounded text-blue-100 text-sm"/>

                                                        </div>

                                                        <div>

                                                            <label className="text-blue-400 text-xs mb-1 block">Cena Sprzeda≈ºy</label>

                                                            <input type="number" value={r.sellPrice} onChange={(e) => updateRecipe(r.id, 'sellPrice', parseFloat(e.target.value) || 0)} className="w-full px-2 py-1 bg-slate-900/80 border border-blue-800/40 rounded text-blue-100 text-sm"/>

                                                        </div>

                                                    </div>

                                                    <div className="mb-3">

                                                        <label className="text-blue-400 text-xs mb-1 block">Sk≈Çadniki:</label>

                                                        {r.ingredients.length === 0 ? (

                                                            <p className="text-blue-400/50 text-xs mb-2">Brak sk≈Çadnik√≥w</p>

                                                        ) : (

                                                            <div className="space-y-2 mb-2">

                                                                {r.ingredients.map((ing, idx) => {

                                                                    const cd = baseCrops.find(c => c.name === ing.crop);

                                                                    const ic = cd ? cd.buyPrice * ing.amount : 0;

                                                                    return (

                                                                        <div key={idx} className="flex gap-2 items-center bg-slate-900/50 p-2 rounded">

                                                                            <select value={ing.crop} onChange={(e) => updateIngredient(r.id, idx, 'crop', e.target.value)} className="flex-1 px-2 py-1 bg-slate-900/80 border border-blue-800/40 rounded text-blue-100 text-sm">

                                                                                <option value="">Wybierz</option>

                                                                                {baseCrops.map(c => <option key={c.id} value={c.name}>{c.name}</option>)}

                                                                            </select>

                                                                            <input type="number" value={ing.amount} onChange={(e) => updateIngredient(r.id, idx, 'amount', parseInt(e.target.value) || 1)} className="w-16 px-2 py-1 bg-slate-900/80 border border-blue-800/40 rounded text-blue-100 text-sm" min="1"/>

                                                                            <span className="text-blue-300 text-xs w-16 text-right">={ic.toFixed(2)}</span>

                                                                            <button onClick={() => deleteIngredient(r.id, idx)} className="text-red-400 px-1">‚úï</button>

                                                                        </div>

                                                                    );

                                                                })}

                                                            </div>

                                                        )}

                                                        <button onClick={() => addIngredient(r.id)} className="text-blue-400 text-xs">+ Dodaj sk≈Çadnik</button>

                                                    </div>

                                                    <div className="grid grid-cols-2 gap-3 pt-3 border-t border-blue-700/40 mb-3">

                                                        <div className="text-center">

                                                            <p className="text-blue-400/70 text-xs">Koszt</p>

                                                            <p className="text-xl font-bold text-yellow-400">{cost.toFixed(2)}</p>

                                                        </div>

                                                        <div className="text-center">

                                                            <p className="text-blue-400/70 text-xs">Zysk</p>

                                                            <p className={`text-xl font-bold ${profit >= 0 ? 'text-emerald-400' : 'text-red-400'}`}>{profit >= 0 ? '+' : ''}{profit.toFixed(2)}</p>

                                                        </div>

                                                    </div>

                                                    <button onClick={() => deleteRecipe(r.id)} className="w-full py-1 bg-red-700/30 text-red-400 rounded text-sm">Usu≈Ñ</button>

                                                </div>

                                            );

                                        })}

                                    </div>

                                )}

                                <div className="flex gap-3 mt-4">

                                    <button onClick={addRecipe} className="px-4 py-2 bg-blue-700 hover:bg-blue-600 text-white rounded font-semibold">+ Dodaj Recepturƒô</button>

                                    <button onClick={loadData} className="px-4 py-2 bg-purple-700 hover:bg-purple-600 text-white rounded font-semibold">üîÑ Od≈õwie≈º</button>

                                </div>

                            </div>

                        )}

                    </div>

                </div>

            );

        }


        ReactDOM.render(<App />, document.getElementById('root'));

    </script>

</body>

</html> 
